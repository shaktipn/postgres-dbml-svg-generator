name: 'postgres-dbml-svg-generator'
description: 'Generates DBML file and SVG diagram of a PostgreSQL migrated DB Schema.'
author: 'shaktipn'
inputs:
    DB_HOST:
        description: 'The hostname of the PostgreSQL DB'
        required: true
    DB_PORT:
        description: 'The port number of the PostgreSQL DB'
        required: false
        default: '5432'
    DB_NAME:
        description: 'The name of the PostgreSQL database'
        required: true
    DB_SCHEMA_NAME:
        description: 'The name of the PostgreSQL schema'
        required: false
        default: 'public'
    DB_USERNAME:
        description: 'The username for accessing the PostgreSQL DB'
        required: true
    DB_PASSWORD:
        description: 'The password for the given PostgreSQL User'
        required: true
    DBML_OUTPUT_LOCATION:
        description: 'Full Path for the generated DBML file'
        required: true
    SVG_OUTPUT_LOCATION:
        description: 'Full Path for the generated SVG file'
        required: true
runs:
    using: 'composite'
    steps:
        - name: Checkout private repo to github-actions-private
          uses: actions/checkout@v4
          with:
              repository: shaktipn/postgres-dbml-svg-generator
              path: .github/github-actions-private
              ref: main
        - name: 'Generate DBML and SVG'
          working-directory: .github/github-actions-private
          shell: 'bash'
          run: npm run start
        - name: 'Commit and push generated files'
          uses: stefanzweifel/git-auto-commit-action@v5
          with:
              commit_message: Generate DBML file and SVG diagram
              file_pattern: ${{ inputs.DBML_OUTPUT_LOCATION }} ${{ inputs.SVG_OUTPUT_LOCATION }}
